<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>记一次手动收入预测 | Blue Star's Blog</title><meta name="author" content="Neuroblue"><meta name="copyright" content="Neuroblue"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="这是一个基于 python 的基于收入预测支出的简单程序。 123456789101112# 每月收入x &#x3D; [9558, 8835, 9313, 14990, 5564, 11227, 11806, 10242, 11999, 11630,     6906, 13850, 7483, 8090, 9465, 9938, 11414, 3200, 10731, 19880,     15500">
<meta property="og:type" content="article">
<meta property="og:title" content="记一次手动收入预测">
<meta property="og:url" content="https://bluestar-34.github.io/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/index.html">
<meta property="og:site_name" content="Blue Star&#39;s Blog">
<meta property="og:description" content="这是一个基于 python 的基于收入预测支出的简单程序。 123456789101112# 每月收入x &#x3D; [9558, 8835, 9313, 14990, 5564, 11227, 11806, 10242, 11999, 11630,     6906, 13850, 7483, 8090, 9465, 9938, 11414, 3200, 10731, 19880,     15500">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://bluestar-34.github.io/img/1.jpg">
<meta property="article:published_time" content="2025-04-03T13:52:59.000Z">
<meta property="article:modified_time" content="2025-04-03T15:04:38.715Z">
<meta property="article:author" content="Neuroblue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bluestar-34.github.io/img/1.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "记一次手动收入预测",
  "url": "https://bluestar-34.github.io/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/",
  "image": "https://bluestar-34.github.io/img/1.jpg",
  "datePublished": "2025-04-03T13:52:59.000Z",
  "dateModified": "2025-04-03T15:04:38.715Z",
  "author": [
    {
      "@type": "Person",
      "name": "Neuroblue",
      "url": "https://bluestar-34.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/B.png"><link rel="canonical" href="https://bluestar-34.github.io/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '记一次手动收入预测',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/hacker1.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/1.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/nav1.jpg" alt="Logo"><span class="site-name">Blue Star's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">记一次手动收入预测</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">记一次手动收入预测</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-03T13:52:59.000Z" title="Created 2025-04-03 21:52:59">2025-04-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-04-03T15:04:38.715Z" title="Updated 2025-04-03 23:04:38">2025-04-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><hr>
<p>这是一个基于 python 的基于收入预测支出的简单程序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每月收入</span></span><br><span class="line">x = [<span class="number">9558</span>, <span class="number">8835</span>, <span class="number">9313</span>, <span class="number">14990</span>, <span class="number">5564</span>, <span class="number">11227</span>, <span class="number">11806</span>, <span class="number">10242</span>, <span class="number">11999</span>, <span class="number">11630</span>,</span><br><span class="line">     <span class="number">6906</span>, <span class="number">13850</span>, <span class="number">7483</span>, <span class="number">8090</span>, <span class="number">9465</span>, <span class="number">9938</span>, <span class="number">11414</span>, <span class="number">3200</span>, <span class="number">10731</span>, <span class="number">19880</span>,</span><br><span class="line">     <span class="number">15500</span>, <span class="number">10343</span>, <span class="number">11100</span>, <span class="number">10020</span>, <span class="number">7587</span>, <span class="number">6120</span>, <span class="number">5386</span>, <span class="number">12038</span>, <span class="number">13360</span>, <span class="number">10885</span>,</span><br><span class="line">     <span class="number">17010</span>, <span class="number">9247</span>, <span class="number">13050</span>, <span class="number">6691</span>, <span class="number">7890</span>, <span class="number">9070</span>, <span class="number">16899</span>, <span class="number">8975</span>, <span class="number">8650</span>, <span class="number">9100</span>,</span><br><span class="line">     <span class="number">10990</span>, <span class="number">9184</span>, <span class="number">4811</span>, <span class="number">14890</span>, <span class="number">11313</span>, <span class="number">12547</span>, <span class="number">8300</span>, <span class="number">12400</span>, <span class="number">9853</span>, <span class="number">12890</span>]</span><br><span class="line"><span class="comment"># 每月支出</span></span><br><span class="line">y = [<span class="number">3171</span>, <span class="number">2183</span>, <span class="number">3091</span>, <span class="number">5928</span>, <span class="number">182</span>, <span class="number">4373</span>, <span class="number">5297</span>, <span class="number">3788</span>, <span class="number">5282</span>, <span class="number">4166</span>,</span><br><span class="line">     <span class="number">1674</span>, <span class="number">5045</span>, <span class="number">1617</span>, <span class="number">1707</span>, <span class="number">3096</span>, <span class="number">3407</span>, <span class="number">4674</span>, <span class="number">361</span>, <span class="number">3599</span>, <span class="number">6584</span>,</span><br><span class="line">     <span class="number">6356</span>, <span class="number">3859</span>, <span class="number">4519</span>, <span class="number">3352</span>, <span class="number">1634</span>, <span class="number">1032</span>, <span class="number">1106</span>, <span class="number">4951</span>, <span class="number">5309</span>, <span class="number">3800</span>,</span><br><span class="line">     <span class="number">5672</span>, <span class="number">2901</span>, <span class="number">5439</span>, <span class="number">1478</span>, <span class="number">1424</span>, <span class="number">2777</span>, <span class="number">5682</span>, <span class="number">2554</span>, <span class="number">2117</span>, <span class="number">2845</span>,</span><br><span class="line">     <span class="number">3867</span>, <span class="number">2962</span>,  <span class="number">882</span>, <span class="number">5435</span>, <span class="number">4174</span>, <span class="number">4948</span>, <span class="number">2376</span>, <span class="number">4987</span>, <span class="number">3329</span>, <span class="number">5002</span>]</span><br></pre></td></tr></table></figure>

<p>一组散点数据，为预测模型提供输入。</p>
<p>绘制散点图看一下效果</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))  <span class="comment"># 设置图形大小</span></span><br><span class="line">    plt.scatter(x, y, alpha=<span class="number">0.5</span>, c=<span class="string">&#x27;blue&#x27;</span>, label=<span class="string">&#x27;实际数据&#x27;</span>)  <span class="comment"># 绘制散点图</span></span><br><span class="line">    plt.xlabel(<span class="string">&#x27;月收入（元）&#x27;</span>)  <span class="comment"># x轴标签</span></span><br><span class="line">    plt.ylabel(<span class="string">&#x27;月网购支出（元）&#x27;</span>)  <span class="comment"># y轴标签</span></span><br><span class="line">    plt.title(<span class="string">&#x27;月收入与网购支出关系散点图&#x27;</span>)  <span class="comment"># 图表标题</span></span><br><span class="line">    plt.grid(<span class="literal">True</span>)  <span class="comment"># 添加网格</span></span><br><span class="line">    plt.legend()  <span class="comment"># 显示图例</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加回归线</span></span><br><span class="line">    <span class="comment">#x_line = np.array([min(x), max(x)])</span></span><br><span class="line">    <span class="comment">#y_line = a * x_line + b</span></span><br><span class="line">    <span class="comment">#plt.plot(x_line, y_line, &#x27;r-&#x27;, label=&#x27;回归线&#x27;)</span></span><br><span class="line">    //回归线 a,b 参数的值这里没有确定</span><br><span class="line"></span><br><span class="line">    plt.show()  <span class="comment"># 显示图形</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/image-20250403220217519.png" alt="image-20250403220217519"></p>
<p>可以看到，x,y 成线性相关</p>
<p>同时，利用 numpy 计算一下 x,y 的相关系数</p>
<p> <code>print(np.corrcoef(x, y))</code></p>
<p>&#x3D;&#x3D;》</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[1.         0.94862936]</span><br><span class="line"> [0.94862936 1.        ]]</span><br></pre></td></tr></table></figure>

<p>相关系数 0.94862936   (接近 -1 或者 1 为强相关)</p>
<h1 id="KNN算法预测"><a href="#KNN算法预测" class="headerlink" title="KNN算法预测"></a>KNN算法预测</h1><p>- 使用 heapq.nsmallest 找出k个最接近的收入值</p>
<p>- 计算这k个收入值对应的支出的平均值作为预测结果</p>
<p>大白话：就是给一个 X_ 收入，找出距离 X_ 最近的 K 个数 x，取这 K 个数对应 y 值的平均值作为 X_ 的 Y_ 的预测结果。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sample_data = &#123;key:value <span class="keyword">for</span> key,value <span class="keyword">in</span> <span class="built_in">zip</span>(x,y)&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict_by_knn</span>(<span class="params">history_data, param_in, k=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用kNN算法做预测</span></span><br><span class="line"><span class="string">    :param history_data: 历史数据</span></span><br><span class="line"><span class="string">    :param param_in: 模型的输入</span></span><br><span class="line"><span class="string">    :param k: 邻居数量（默认值为5）</span></span><br><span class="line"><span class="string">    :return: 模型的输出（预测值）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    neighbors = heapq.nsmallest(k, history_data, key=<span class="keyword">lambda</span> x: (x - param_in) ** <span class="number">2</span>)		//求最近的x</span><br><span class="line">    <span class="keyword">return</span> statistics.mean([history_data[neighbor] <span class="keyword">for</span> neighbor <span class="keyword">in</span> neighbors])			//求平均值y_</span><br><span class="line"></span><br><span class="line">incomes  = [<span class="number">1800</span>, <span class="number">3500</span>, <span class="number">5200</span>, <span class="number">6600</span>, <span class="number">13400</span>, <span class="number">17800</span>, <span class="number">20000</span>, <span class="number">30000</span>]</span><br><span class="line"><span class="keyword">for</span> income <span class="keyword">in</span> incomes:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;月收入：<span class="subst">&#123;income:&gt;5d&#125;</span>,月网购支出：<span class="subst">&#123;predict_by_knn(sample_data, income):&gt;<span class="number">6.1</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">月收入： 1800,月支出： 712.6</span><br><span class="line">月收入： 3500,月支出： 712.6</span><br><span class="line">月收入： 5200,月支出： 936.0</span><br><span class="line">月收入： 6600,月支出：1487.0</span><br><span class="line">月收入：13400,月支出：5148.6</span><br><span class="line">月收入：17800,月支出：6044.4</span><br><span class="line">月收入：20000,月支出：6044.4</span><br><span class="line">月收入：30000,月支出：6044.4</span><br></pre></td></tr></table></figure>

<p>可以看到，预测结果简直一坨</p>
<p>原因是这种根据距离求平均值的算法误差太大？</p>
<h1 id="楞猜法预测"><a href="#楞猜法预测" class="headerlink" title="楞猜法预测"></a>楞猜法预测</h1><p>由于已知该数据呈一定的线性关系，所以可以根据直线 y&#x3D;ax + b 去拟合</p>
<p>而参数 a，b 就是我们需要找到的值</p>
<p>问题转化如何找到 a，b,使拟合效果最好</p>
<p>于是定义损失函数求均方误差，就是高中学的方差的平均值</p>
<p>先定义一个很大的 current_loss，然后随机取 a,b，带入 X_ ，将求出的平均方差与 current_loss 比较，若平均方差较小，则更新 current_loss ，继续随机取 a,b ，直到找到使 current_loss 最小的 a,b ，即为所求参数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_loss</span>(<span class="params">X_,Y_,a_,b_</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;损失函数</span></span><br><span class="line"><span class="string">    :param X_: 回归模型的自变量</span></span><br><span class="line"><span class="string">    :param y_: 回归模型的因变量</span></span><br><span class="line"><span class="string">    :param a_: 回归模型的斜率</span></span><br><span class="line"><span class="string">    :param b_: 回归模型的截距</span></span><br><span class="line"><span class="string">    :return: MSE（均方误差）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    y_hat = [a_ * x + b_ <span class="keyword">for</span> x <span class="keyword">in</span> X_]</span><br><span class="line">    <span class="keyword">return</span> statistics.mean((v1 -v1)**<span class="number">2</span> <span class="keyword">for</span> v1,v2 <span class="keyword">in</span> <span class="built_in">zip</span>(y_hat,Y_))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 先将最小损失定义为一个很大的值</span></span><br><span class="line">min_loss, a, b = <span class="number">1e12</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="comment"># 目标是找到一组 a,b 使损失函数最小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        _a, _b = random.random(), random.random() * <span class="number">4000</span> - <span class="number">2000</span></span><br><span class="line">        loss = get_loss(x, y, _a, _b)</span><br><span class="line">        <span class="keyword">if</span> loss &lt; min_loss:</span><br><span class="line">            min_loss, a, b = loss, _a, _b</span><br><span class="line">            <span class="comment"># 损失值不断减小，a,b 值不断更新并记录</span></span><br><span class="line">        pbar.update(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最小损失为：<span class="subst">&#123;min_loss:<span class="number">.2</span>f&#125;</span>, 对应的斜率为：<span class="subst">&#123;a:<span class="number">.2</span>f&#125;</span>, 对应的截距为：<span class="subst">&#123;b:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">incomes  = [<span class="number">1800</span>, <span class="number">3500</span>, <span class="number">5200</span>, <span class="number">6600</span>, <span class="number">13400</span>, <span class="number">17800</span>, <span class="number">20000</span>, <span class="number">30000</span>]</span><br><span class="line"><span class="keyword">for</span> income <span class="keyword">in</span> incomes:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;月收入：<span class="subst">&#123;income:&gt;5d&#125;</span>,月网购支出：<span class="subst">&#123;(<span class="keyword">lambda</span> x:a*x + b)(income):&gt;<span class="number">6.1</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;》</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">最小损失为：0.00, 对应的斜率为：0.42, 对应的截距为：-9.39</span><br><span class="line">月收入： 1800,月网购支出： 741.7</span><br><span class="line">月收入： 3500,月网购支出：1451.1</span><br><span class="line">月收入： 5200,月网购支出：2160.5</span><br><span class="line">月收入： 6600,月网购支出：2744.7</span><br><span class="line">月收入：13400,月网购支出：5582.2</span><br><span class="line">月收入：17800,月网购支出：7418.3</span><br><span class="line">月收入：20000,月网购支出：8336.3</span><br><span class="line">月收入：30000,月网购支出：12509.2</span><br></pre></td></tr></table></figure>

<p>效果一般</p>
<p>增大随机模拟次数，加上进度条动态展示模拟进度</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">min_loss, a, b = <span class="number">1e12</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="comment"># 目标是找到一组 a,b 使损失函数最小</span></span><br><span class="line"></span><br><span class="line">total_iterations = <span class="number">10000000</span>			//更多次随机模拟</span><br><span class="line"><span class="keyword">with</span> tqdm(total=total_iterations, desc=<span class="string">&quot;训练进度&quot;</span>) <span class="keyword">as</span> pbar:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(total_iterations):</span><br><span class="line">        _a, _b = random.random(), random.random() * <span class="number">4000</span> - <span class="number">2000</span></span><br><span class="line">        loss = get_loss(x, y, _a, _b)</span><br><span class="line">        <span class="keyword">if</span> loss &lt; min_loss:</span><br><span class="line">            min_loss, a, b = loss, _a, _b</span><br><span class="line">            <span class="comment"># 损失值不断减小，a,b 值不断更新并记录</span></span><br><span class="line">        pbar.update(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最小损失为：<span class="subst">&#123;min_loss:<span class="number">.2</span>f&#125;</span>, 对应的斜率为：<span class="subst">&#123;a:<span class="number">.2</span>f&#125;</span>, 对应的截距为：<span class="subst">&#123;b:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">incomes  = [<span class="number">1800</span>, <span class="number">3500</span>, <span class="number">5200</span>, <span class="number">6600</span>, <span class="number">13400</span>, <span class="number">17800</span>, <span class="number">20000</span>, <span class="number">30000</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> income <span class="keyword">in</span> incomes:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;月收入：<span class="subst">&#123;income:&gt;5d&#125;</span>,月网购支出：<span class="subst">&#123;(<span class="keyword">lambda</span> x:a*x + b)(income):&gt;<span class="number">6.1</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">训练进度: 100%|███████████████████████████| 100000000/100000000 [25:49&lt;00:00, 64552.47it/s]</span><br><span class="line">最小损失为：0.00, 对应的斜率为：0.74, 对应的截距为：-196.56</span><br><span class="line">月收入： 1800,月网购支出：1128.8</span><br><span class="line">月收入： 3500,月网购支出：2380.6</span><br><span class="line">月收入： 5200,月网购支出：3632.3</span><br><span class="line">月收入： 6600,月网购支出：4663.2</span><br><span class="line">月收入：13400,月网购支出：9670.2</span><br><span class="line">月收入：17800,月网购支出：12910.0</span><br><span class="line">月收入：20000,月网购支出：14529.9</span><br><span class="line">月收入：30000,月网购支出：21893.1</span><br></pre></td></tr></table></figure>

<p>可见，随着模拟次数的增加，current_loss 越小，a,b 的取值越准确</p>
<p>最后，我们根据这个 a,b 值，来重新画出回归线</p>
<p><img src="/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/image-20250403222447698.png" alt="image-20250403222447698"></p>
<p>仍然拟合地一坨，后续再进行优化。</p>
<p>后记：初探人工智障，菜鸡一枚。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://bluestar-34.github.io">Neuroblue</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://bluestar-34.github.io/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/">https://bluestar-34.github.io/2025/04/03/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%89%8B%E5%8A%A8%E6%94%B6%E5%85%A5%E9%A2%84%E6%B5%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/03/hello-world/" title="Hello World"><img class="cover" src="/img/7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a><a class="pagination-related" href="/2025/04/09/%E5%9B%BE%E7%89%87%E6%B5%8B%E8%AF%95/" title="图片测试"><img class="cover" src="/img/10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">图片测试</div></div><div class="info-2"><div class="info-item-1"> </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Neuroblue</div><div class="author-info-description">BBBBBBBlue.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Bluestar-34/Bluestar-34.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is a lonely blue star.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#KNN%E7%AE%97%E6%B3%95%E9%A2%84%E6%B5%8B"><span class="toc-number">1.</span> <span class="toc-text">KNN算法预测</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A5%9E%E7%8C%9C%E6%B3%95%E9%A2%84%E6%B5%8B"><span class="toc-number">2.</span> <span class="toc-text">楞猜法预测</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/16/%E7%88%AC%E8%99%AB%E7%BB%83%E6%89%8B2%EF%BC%9Agithub%E7%83%AD%E9%97%A8%E8%AF%AD%E8%A8%80%E9%A1%B9%E7%9B%AE/" title="爬虫练手2：github热门语言项目"><img src="/img/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="爬虫练手2：github热门语言项目"/></a><div class="content"><a class="title" href="/2025/04/16/%E7%88%AC%E8%99%AB%E7%BB%83%E6%89%8B2%EF%BC%9Agithub%E7%83%AD%E9%97%A8%E8%AF%AD%E8%A8%80%E9%A1%B9%E7%9B%AE/" title="爬虫练手2：github热门语言项目">爬虫练手2：github热门语言项目</a><time datetime="2025-04-16T06:48:43.000Z" title="Created 2025-04-16 14:48:43">2025-04-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/XYCTF2024%E5%A4%8D%E7%8E%B0/" title="XYCTF2024复现"><img src="/img/6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="XYCTF2024复现"/></a><div class="content"><a class="title" href="/2025/04/15/XYCTF2024%E5%A4%8D%E7%8E%B0/" title="XYCTF2024复现">XYCTF2024复现</a><time datetime="2025-04-15T10:21:28.000Z" title="Created 2025-04-15 18:21:28">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/14/numpy1/" title="numpy1"><img src="/img/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="numpy1"/></a><div class="content"><a class="title" href="/2025/04/14/numpy1/" title="numpy1">numpy1</a><time datetime="2025-04-14T12:36:12.000Z" title="Created 2025-04-14 20:36:12">2025-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E5%B0%8F%E7%88%AC%E8%99%AB%E7%88%AC%E5%8F%96%E7%8E%8B%E8%80%85%E8%8D%A3%E8%80%80%E8%8B%B1%E9%9B%84%E5%A4%B4%E5%83%8F%E4%B9%8B%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%B3%95/" title="小爬虫爬取王者荣耀英雄头像之多种方法"><img src="/img/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小爬虫爬取王者荣耀英雄头像之多种方法"/></a><div class="content"><a class="title" href="/2025/04/13/%E5%B0%8F%E7%88%AC%E8%99%AB%E7%88%AC%E5%8F%96%E7%8E%8B%E8%80%85%E8%8D%A3%E8%80%80%E8%8B%B1%E9%9B%84%E5%A4%B4%E5%83%8F%E4%B9%8B%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%B3%95/" title="小爬虫爬取王者荣耀英雄头像之多种方法">小爬虫爬取王者荣耀英雄头像之多种方法</a><time datetime="2025-04-13T11:03:45.000Z" title="Created 2025-04-13 19:03:45">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E6%89%8B%E6%90%93%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%86%E5%88%AB%E7%8C%AB%E7%8C%AB%E5%9B%BE%E5%83%8F/" title="手搓一个简单的神经网络识别猫猫图像"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手搓一个简单的神经网络识别猫猫图像"/></a><div class="content"><a class="title" href="/2025/04/13/%E6%89%8B%E6%90%93%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AF%86%E5%88%AB%E7%8C%AB%E7%8C%AB%E5%9B%BE%E5%83%8F/" title="手搓一个简单的神经网络识别猫猫图像">手搓一个简单的神经网络识别猫猫图像</a><time datetime="2025-04-13T04:31:30.000Z" title="Created 2025-04-13 12:31:30">2025-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Neuroblue</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>